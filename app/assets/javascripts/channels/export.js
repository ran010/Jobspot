if (window.ExportChannel == null) {
  window.ExportChannel = {};
}

window.ExportChannel.Subscribe = function(export_id, callback) {
  App["export"] = App.cable.subscriptions.create({
    channel: 'ExportChannel',
    export_id: export_id
  }, {
    connected: function() {
      console.log("connects");
      return callback();
    },
    disconnected: function() {
      console.log("dissconnect")

    },
    received: function(data) {
      var blob, csv_download_link;
      blob = new Blob([data['json_file']['content']]);
      csv_download_link = document.createElement('a');
      csv_download_link.href = window.URL.createObjectURL(blob);
      csv_download_link.download = data['json_file']['file_name'];
      csv_download_link.click();

      $(".export-btn").html("Export Data");
      $(".export-btn").removeClass("disabled");
      App["export"].unsubscribe();
      App.cable.disconnect();
      delete App["export"];
    }
  });
};

// ---
// generated by coffee-script 1.9.2